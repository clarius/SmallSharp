<!DOCTYPE html>
<html lang="en-US">

  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,maximum-scale=2">
    <link rel="stylesheet" type="text/css" media="screen" href="/SmallSharp/assets/css/style.css?v=b20e1ce7ddcd93054aaa5ea95bc812846f55bc02">

<!-- Begin Jekyll SEO tag v2.6.1 -->
<title>SmallSharp | Create, edit and run multiple C# top-level programs in the same project by just selecting the startup program from the start button.</title>
<meta name="generator" content="Jekyll v3.9.0" />
<meta property="og:title" content="SmallSharp" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Create, edit and run multiple C# top-level programs in the same project by just selecting the startup program from the start button." />
<meta property="og:description" content="Create, edit and run multiple C# top-level programs in the same project by just selecting the startup program from the start button." />
<meta property="og:site_name" content="SmallSharp" />
<script type="application/ld+json">
{"@type":"WebSite","description":"Create, edit and run multiple C# top-level programs in the same project by just selecting the startup program from the start button.","url":"/SmallSharp/","name":"SmallSharp","headline":"SmallSharp","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/devlooped/SmallSharp">View on GitHub</a>

          <h1 id="project_title">SmallSharp</h1>
          <h2 id="project_tagline">Create, edit and run multiple C# top-level programs  in the same project by just selecting the startup program from the start  button.</h2>

          
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <h1 id="-smallsharp"><img src="https://raw.githubusercontent.com/devlooped/SmallSharp/main/assets/img/icon-32.png" alt="Icon" /> SmallSharp</h1>

<p><a href="https://www.nuget.org/packages/SmallSharp"><img src="https://img.shields.io/nuget/v/SmallSharp.svg?color=royalblue" alt="Version" /></a> <a href="https://www.nuget.org/packages/SmallSharp"><img src="https://img.shields.io/nuget/dt/SmallSharp?color=darkmagenta" alt="Downloads" /></a> <a href="https://github.com/devlooped/SmallSharp/blob/main/LICENSE"><img src="https://img.shields.io/github/license/devlooped/SmallSharp.svg?color=blue" alt="License" /></a> <a href="https://github.com/devlooped/avatar/actions?query=branch%3Amain+workflow%3Abuild+"><img src="https://github.com/devlooped/SmallSharp/workflows/build/badge.svg?branch=main" alt="GH CI Status" /></a></p>

<p><img src="https://raw.githubusercontent.com/devlooped/SmallSharp/main/assets/img/SmallSharpDemo.gif" alt="Icon" /></p>

<!-- #content -->
<p>Create, edit and run multiple C# top-level programs in the same project üòç</p>

<h2 id="why">Why</h2>

<p>The new-ish C# <a href="https://learn.microsoft.com/en-us/dotnet/csharp/fundamentals/program-structure/top-level-statements">top-level programs</a> 
allow a very intuitive, simple and streamlined experience for quickly spiking or learning C#.</p>

<p>One missing thing since their introduction in Visual Studio is that you can only have one such 
top-level program in a project. This means that in order to prototype or learn a different area 
of .NET, you‚Äôd be forced to either replace your previous top-level program or change it to be a 
non-compile item somehow so you can keep it around (i.e. rename to a <code class="language-plaintext highlighter-rouge">.txt</code> or change its build action).</p>

<p><strong>SmallSharp</strong> allows you to select which file should be the top-level program to run, right from 
the Start button/dropdown (for compilation and launch/debug). Moreover, it will monitor the active 
file you‚Äôre editing, and automatically make it the startup file for you!</p>

<p><img src="https://raw.githubusercontent.com/devlooped/SmallSharp/main/assets/img/launchSettings.png" alt="start button" /></p>

<p>This list is automatically kept in sync as you add more <code class="language-plaintext highlighter-rouge">.cs</code> files to the project. When you select 
one target C# file, that becomes the only top-level program to be compiled, so you don‚Äôt have to 
modify any of the others since they automatically become <em>None</em> items.</p>

<p>All compile files directly under the project directory root are considered top-level programs for 
selection and compilation purposes. If you need to share code among them, you can place them in 
subdirectories and those will behave like normal compile items.</p>

<h2 id="usage">Usage</h2>

<p>There is no need to install any Visual Studio extension. SmallSharp works by just installing the 
<a href="https://nuget.org/packages/SmallSharp">SmallSharp</a> nuget package in a C# console project.</p>

<ol>
  <li>Create a new Console project:</li>
</ol>

<p><img src="https://raw.githubusercontent.com/devlooped/SmallSharp/main/assets/img/NewConsoleProject.png" alt="New Project Dialog" /></p>

<p>By default, this new console project may not be set up to target <code class="language-plaintext highlighter-rouge">net5.0</code> or use the latest C# version. 
   So click on the project node, and the project file will open in the editor. Make sure you either:</p>

<ul>
  <li>Target the recommended framework version (i.e. net6.0):</li>
</ul>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;Project</span> <span class="na">Sdk=</span><span class="s">"Microsoft.NET.Sdk"</span><span class="nt">&gt;</span>

  <span class="nt">&lt;PropertyGroup&gt;</span>
    <span class="nt">&lt;OutputType&gt;</span>Exe<span class="nt">&lt;/OutputType&gt;</span>
    <span class="nt">&lt;TargetFramework&gt;</span>net6.0<span class="nt">&lt;/TargetFramework&gt;</span>
  <span class="nt">&lt;/PropertyGroup&gt;</span>

<span class="nt">&lt;/Project&gt;</span>
</code></pre></div></div>

<ul>
  <li>Or use latest C# language version if targeting another framework:</li>
</ul>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;Project</span> <span class="na">Sdk=</span><span class="s">"Microsoft.NET.Sdk"</span><span class="nt">&gt;</span>

  <span class="nt">&lt;PropertyGroup&gt;</span>
    <span class="nt">&lt;OutputType&gt;</span>Exe<span class="nt">&lt;/OutputType&gt;</span>
    <span class="nt">&lt;TargetFramework&gt;</span>net472<span class="nt">&lt;/TargetFramework&gt;</span>
    <span class="nt">&lt;LangVersion&gt;</span>latest<span class="nt">&lt;/LangVersion&gt;</span>
  <span class="nt">&lt;/PropertyGroup&gt;</span>

<span class="nt">&lt;/Project&gt;</span>
</code></pre></div></div>

<ol>
  <li>Install the <strong>SmallSharp</strong> nuget package using your preferred method:</li>
</ol>

<ul>
  <li>From the Dependencies node, Manage NuGet Packages dialog:</li>
</ul>

<p><img src="https://raw.githubusercontent.com/devlooped/SmallSharp/main/assets/img/NuGetPackage.png" alt="New Project Dialog" /></p>

<ul>
  <li>By just adding it directly to the .csproj:</li>
</ul>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nt">&lt;ItemGroup&gt;</span>
    <span class="nt">&lt;PackageReference</span> <span class="na">Include=</span><span class="s">"SmallSharp"</span> <span class="na">Version=</span><span class="s">"*"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;/ItemGroup&gt;</span>
</code></pre></div></div>

<ul>
  <li>Via the dotnet CLI:</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt; dotnet add package SmallSharp
</code></pre></div></div>

<ul>
  <li>Via the Package Manager console:</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>PM&gt; install-package SmallSharp
</code></pre></div></div>

<ol>
  <li>Now open that Program.cs and make changes to the new concise top-level program such as:</li>
</ol>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">static</span> <span class="n">System</span><span class="p">.</span><span class="n">Console</span><span class="p">;</span>

<span class="nf">WriteLine</span><span class="p">(</span><span class="s">"Hello World!"</span><span class="p">);</span>
</code></pre></div></div>

<p>Keep adding as many top-level programs as you need, and switch between them easily by simply 
changing the active document.</p>

<p><img src="https://raw.githubusercontent.com/devlooped/SmallSharp/main/assets/img/TrackSelection.gif" alt="Demo" /></p>

<h2 id="how-it-works">How It Works</h2>

<p>This nuget package leverages in concert the following standalone and otherwise 
unrelated features of the compiler, nuget, Visual Studio and MSBuild:</p>

<ol>
  <li>The C# compiler only allows one top-level program per compilation.</li>
  <li>Launch profiles (the entries in the Run dropdown) are populated from the Properties\launchSettings.json file</li>
  <li>Whenever changed, the dropdown selection is persisted as the <code class="language-plaintext highlighter-rouge">$(ActiveDebugProfile)</code> MSBuild property in a file 
named after the project with the <code class="language-plaintext highlighter-rouge">.user</code> extension</li>
  <li>This file is imported before NuGet-provided MSBuild targets</li>
  <li>The <code class="language-plaintext highlighter-rouge">$(DefaultItemExcludesInProjectFolder)</code> MSBuild property allows excluding items at the project-level from 
the automatically added items by the SDK.</li>
</ol>

<p>Using the above features in concert, <strong>SmallSharp</strong> essentially does the following:</p>

<ul>
  <li>
    <p>Monitor the active document in VS and emit it as a <code class="language-plaintext highlighter-rouge">launchSettings.json</code> profile and set it as 
 the <code class="language-plaintext highlighter-rouge">$(ActiveDebugProfile)</code>.</p>
  </li>
  <li>
    <p>Exclude <code class="language-plaintext highlighter-rouge">.cs</code> files at the project level from being included as <code class="language-plaintext highlighter-rouge">&lt;Compile&gt;</code> by the default SDK 
includes and include them explicitly as <code class="language-plaintext highlighter-rouge">&lt;None&gt;</code> instead so they show up in the solution explorer. 
This prevents the compiler from causing an error for multiple top-level programs.</p>
  </li>
  <li>
    <p>Explicitly include as <code class="language-plaintext highlighter-rouge">&lt;Compile&gt;</code> only the <code class="language-plaintext highlighter-rouge">$(ActiveDebugProfile)</code> property value.</p>
  </li>
</ul>

<p>This basically mean that this it will also work consistently if you use <code class="language-plaintext highlighter-rouge">dotnet run</code> from the command-line, 
since the ‚ÄúMain‚Äù file selection is performed exclusively via MSBuild item manipulation.</p>

<p>Finally, there is some lovely COM-based magic to access the active Visual Studio IDE (via DTE) to monitor 
the currently opened source file to keep it in sync with the launch profile. This is done purely using 
public COM primitives and equally public VSSDK nuget packages their APIs. This enables some useful integration 
with the IDE without requiring installing a VS extension from the marketplace and deal with gracefully 
degrading functionality.</p>

<blockquote>
  <p>NOTE: If active document tracking fails to initialize properly restarting Visual Studio will almost 
always fix it. Once tracking starts, it will work consistently from that point on. The Start dropdown 
is always available as a fallback in case of issues.</p>
</blockquote>

<!-- include https://github.com/devlooped/sponsors/raw/main/footer.md -->
<h1 id="sponsors">Sponsors</h1>

<!-- sponsors.md -->
<p><a href="https://github.com/clarius"><img src="https://raw.githubusercontent.com/devlooped/sponsors/main/.github/avatars/clarius.png" alt="Clarius Org" title="Clarius Org" /></a>
<a href="https://github.com/MelbourneDeveloper"><img src="https://raw.githubusercontent.com/devlooped/sponsors/main/.github/avatars/MelbourneDeveloper.png" alt="Christian Findlay" title="Christian Findlay" /></a>
<a href="https://github.com/augustoproiete"><img src="https://raw.githubusercontent.com/devlooped/sponsors/main/.github/avatars/augustoproiete.png" alt="C. Augusto Proiete" title="C. Augusto Proiete" /></a>
<a href="https://github.com/KirillOsenkov"><img src="https://raw.githubusercontent.com/devlooped/sponsors/main/.github/avatars/KirillOsenkov.png" alt="Kirill Osenkov" title="Kirill Osenkov" /></a>
<a href="https://github.com/MFB-Technologies-Inc"><img src="https://raw.githubusercontent.com/devlooped/sponsors/main/.github/avatars/MFB-Technologies-Inc.png" alt="MFB Technologies, Inc." title="MFB Technologies, Inc." /></a>
<a href="https://github.com/sandrock"><img src="https://raw.githubusercontent.com/devlooped/sponsors/main/.github/avatars/sandrock.png" alt="SandRock" title="SandRock" /></a>
<a href="https://github.com/eeseewy"><img src="https://raw.githubusercontent.com/devlooped/sponsors/main/.github/avatars/eeseewy.png" alt="Eric C" title="Eric C" /></a>
<a href="https://github.com/agocke"><img src="https://raw.githubusercontent.com/devlooped/sponsors/main/.github/avatars/agocke.png" alt="Andy Gocke" title="Andy Gocke" /></a></p>

<!-- sponsors.md -->

<p><a href="https://github.com/sponsors/devlooped"><img src="https://raw.githubusercontent.com/devlooped/sponsors/main/sponsor.png" alt="Sponsor this project" title="Sponsor this project" /></a>
¬†</p>

<p><a href="https://github.com/sponsors">Learn more about GitHub Sponsors</a></p>

<!-- https://github.com/devlooped/sponsors/raw/main/footer.md -->

      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        
        <p class="copyright">SmallSharp maintained by <a href="https://github.com/devlooped">devlooped</a></p>
        
        <p>Published with <a href="https://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

    
  </body>
</html>
